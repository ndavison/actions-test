name: Test

on:
  pull_request_target:
    branches: [master, main]
  workflow_dispatch:

jobs:
  bump_package_versions:
    if: github.event_name == 'workflow_dispatch' || startsWith(github.event.pull_request.head.ref, 'dependabot/nuget/tracer/dependabot/') == true
    runs-on: windows-latest
    env:
      GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"

    steps:
      - name: Support longpaths
        run: git config --system core.longpaths true

      - name: Checkout
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.pull_request.base.sha }}

      - uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '7.0.306'

      - name: "Regenerating package versions"
        run: .\tracer\build.ps1 GeneratePackageVersions
